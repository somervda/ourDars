<div class="page-container">
  <h1>Decision (DAR)</h1>

  <form class="standard-form" [formGroup]="darForm">
    <mat-form-field class="full-width">
      <input
        matInput
        formControlName="title"
        (change)="onTitleUpdate()"
        placeholder="Title"
        required
      />
      <mat-error *ngIf="darForm.controls['title'].hasError('required')">
        Title is required.
      </mat-error>
      <mat-error *ngIf="darForm.controls['title'].hasError('minlength')">
        Title must be at least 10 characters long.
      </mat-error>
      <mat-error *ngIf="darForm.controls['title'].hasError('maxlength')">
        Title can not be more than 60 characters long.
      </mat-error>
    </mat-form-field>

    <mat-form-field class="full-width">
      <textarea
        matInput
        formControlName="description"
        (change)="onDescriptionUpdate()"
        matAutosizeMinRows="7"
        matAutosizeMaxRows="20"
        matTextareaAutosize
        placeholder="Description"
        required
      ></textarea>
      <mat-error *ngIf="darForm.controls['description'].hasError('required')">
        Description is required.
      </mat-error>
      <mat-error *ngIf="darForm.controls['description'].hasError('minlength')">
        Description must be at least 50 characters long.
      </mat-error>
    </mat-form-field>

    <mat-form-field class="half-width">
      <mat-label>Status</mat-label>
      <mat-select
        [value]="dar.darStatus"
        (selectionChange)="onStatusChange($event)"
      >
        <mat-option *ngFor="let item of darStatuses" [value]="item.key">
          {{ item.value | titlecase }}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field class="half-width">
      <mat-label>Methodology</mat-label>
      <mat-select
        [value]="dar.darMethod"
        (selectionChange)="onMethodChange($event)"
      >
        <mat-option *ngFor="let item of darMethods" [value]="item.key">
          {{ item.value }}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <!-- Only show voting options if methodology is vote of hybrid -->
    <div
      *ngIf="
        dar.darMethod == DarMethod.Vote || dar.darMethod == DarMethod.Hybrid
      "
    >
      <mat-form-field class="half-width">
        <input
          matInput
          formControlName="votingMajority"
          (change)="onVotingMajorityUpdate()"
          placeholder="Voting : Majority"
          required
        />
        <mat-error
          *ngIf="darForm.controls['votingMajority'].hasError('required')"
        >
          A voting majority value is required (Enter 0 to represent simple
          majority wins).
        </mat-error>
        <mat-error *ngIf="darForm.controls['votingMajority'].hasError('min')">
          Voting majority must be zero or greater.
        </mat-error>
        <mat-error *ngIf="darForm.controls['votingMajority'].hasError('max')">
          Voting majority must be less then 100(%).
        </mat-error>
        <mat-hint
          >How voting is scored. Enter 0 to indicated a simple plurality or a
          value of 1-100% to indicate a super-majority threshold must be
          passed.</mat-hint
        >
      </mat-form-field>
    </div>

    <mat-form-field class="half-width">
      <input
        matInput
        [matDatepicker]="myDatepicker"
        [value]="dar.dateTargeted ? dar.dateTargeted.toDate() : ''"
        (dateChange)="onDateTargetedChange($event)"
      />
      <mat-datepicker-toggle
        matSuffix
        [for]="myDatepicker"
      ></mat-datepicker-toggle>
      <mat-datepicker #myDatepicker></mat-datepicker>
      <mat-hint>When the decision should be complete</mat-hint>
    </mat-form-field>

    <mat-form-field class="half-width">
      <mat-label>Team</mat-label>
      <mat-select
        (selectionChange)="onTeamChange($event)"
        [value]="dar.tid ? dar.tid : ''"
      >
        <mat-option *ngFor="let team of team$ | async" [value]="team.id">
          {{ team.name }}
        </mat-option>
      </mat-select>
      <mat-hint>Team associated with this decision</mat-hint>
    </mat-form-field>

    <br />
    <br />
    <button
      mat-raised-button
      color="primary"
      *ngIf="crudAction == Crud.Create"
      [disabled]="!darForm.valid"
      (click)="createDar()"
    >
      <mat-icon>add</mat-icon>
      Create
    </button>

    <button
      mat-raised-button
      color="primary"
      *ngIf="crudAction == Crud.Delete"
      (click)="deleteDar()"
    >
      <mat-icon>clear</mat-icon>
      Delete
    </button>
  </form>
</div>
